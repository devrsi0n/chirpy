fragment commentContent on Comment {
  id
  content
  comment: content(path: "content")
  createdAt
  deletedAt
  parentId
  pageId
  user {
    id
    name
    avatar
  }
  likes {
    id
    userId
  }
}

query comments {
  comments {
    id
  }
}

# Find the owner from a triggered comment
query siteOwnerByTriggerCommentId($commentId: uuid!) {
  commentByPk(id: $commentId) {
    page {
      id
      url
      project {
        ownerId: userId
      }
    }
    triggeredBy: user {
      id
      name
    }
  }
}

# Find the the author from a parent comment id
query authorByCommentId($commentId: uuid!) {
  commentByPk(id: $commentId) {
    page {
      id
      url
    }
    author: user {
      id
      name
    }
  }
}

query commentList($limit: Int!, $offset: Int!) {
  comments(limit: $limit, offset: $offset) {
    ...commentContent
    replies(order_by: { likes_aggregate: { count: desc }, createdAt: asc }) {
      ...commentContent
      replies(order_by: { likes_aggregate: { count: desc }, createdAt: asc }) {
        ...commentContent
      }
    }
  }
}
