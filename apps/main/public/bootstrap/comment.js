(function(r){typeof define=="function"&&define.amd?define(r):r()})(function(){"use strict";const r="EVENT_CLICK_CONTAINER",p="ERR_UNMATCHED_DOMAIN",d="[data-chirpy-domain]",c='[data-chirpy-comment="true"]';async function a(){const t=window.document.querySelector(d);if(!t)throw new Error(`Can't find the chirpy domain, did you forget to add ${d} to your script?`);const s=t.dataset.chirpyDomain;if(!s)throw new Error("No domain specified");const u=window.document.querySelector(c);if(!u)throw new Error(`Can't find the render target, did you forget to add ${c}?`);const{origin:y,pathname:E}=window.location,o=await(await fetch(`${void 0}/api/page?domain=${s}&url=${encodeURIComponent(y+E)}&title=${encodeURIComponent(window.document.title)}`)).json();if(l(o)){if(o.code==p)return console.error(o.error);throw new Error(o.error)}if(!o){console.error("Unexpected null from response");return}const f=g(o.id);if(window.document.querySelector(`#${f}`))return;const e=document.createElement("iframe");e.id=f,e.style.width="100%",e.frameBorder="0",e.scrolling="no";let w=0;window.addEventListener("message",n=>{var m,h;n.origin===void 0&&((m=n.data)==null?void 0:m.height)&&((h=n.data)==null?void 0:h.height)!==w&&(e.style.height=n.data.height+"px",w=n.data.height)},!1),window.document.body.addEventListener("click",()=>{var n;(n=e.contentWindow)==null||n.postMessage(r)}),e.src=`${void 0}/widget/comment/${encodeURIComponent(o.url)}`,u.append(e)}function l(t){return!!t.error}const g=t=>`chirpy-${t}`,i=window;i&&!i.disableAutoInjection&&(a(),i.Chirpy={comment:a})});
